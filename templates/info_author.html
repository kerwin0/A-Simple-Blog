{% extends "../../blogs/templates/base.html" %}

{% block content %}
    <h2 class="sub-header">作者管理</h2>
    <a href="{% url "AddAuthor" %}" class="btn btn-primary">添加作者</a>
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
            <tr>
                <th>姓名</th>
                <th>年龄</th>
                <th>手机</th>
                <th>地址</th>
                <th>邮箱</th>
                <th>编辑操作</th>
                <th>删除操作</th>
            </tr>
            </thead>
            <tbody>
            {% for foo in author_list %}
                <tr>
                    <td>{{ foo.name }}</td>
                    <td>{{ foo.age }}</td>
                    <td>{{ foo.phone }}</td>
                    <td>{{ foo.detail.address }}</td>
                    <td>{{ foo.detail.author_email }}</td>

                    <td><a href="/changeauthor/{{ foo.id }}" class="btn btn-primary btn-sm">编辑</a></td>
                    <td><a href="javascript:void(0)" class="btn btn-primary btn-sm my" i="{{ foo.id }}">删除</a></td>
                </tr>
            {% endfor %}

            </tbody>
        </table>
    </div>
    <script>
        $(".my").on("click", function () {
            var a = $(this).attr("i");
            var $fa = $(this).parent().parent();
            swal({
                    title: "确定删除吗？",
                    text: "你将无法恢复该虚拟文件！",
                    type: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "确定删除！",
                    cancelButtonText: "取消删除！",
                    closeOnConfirm: false,
                    closeOnCancel: false
                },
                function (isConfirm) {
                    if (isConfirm) {
                        swal("删除！", "你的虚拟文件已经被删除。",
                            "success");
                        $.ajax({
                            url: "/deleteauthor/" + a,
                            type: "get",
                            success: function (data) {
                                var re = JSON.parse(data);
                                $fa.html("<p style='color:red;text-align:center'>" + re["result"] + "</p>");

                                setTimeout(function () {
                                    $fa.remove();
                                }, 3000)
                            }

                        })
                    } else {
                        swal("取消！", "你的虚拟文件是安全的:)",
                            "error");
                    }
                });

        })

    </script>
{% endblock %}